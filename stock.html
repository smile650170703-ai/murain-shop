<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MURAIN å…§éƒ¨åº«å­˜æŸ¥è©¢ç³»çµ±</title>
    <style>
        :root {
            --primary-color: #1a1a1a;    /* æ¥µè‡´é»‘ */
            --accent-color: #c5a059;     /* é¦™æª³é‡‘ */
            --bg-color: #f9f9f9;
            --text-color: #333;
        }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 40px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        
        /* æ¨™é¡Œæ¨£å¼ */
        .header { text-align: center; border-bottom: 2px solid var(--accent-color); padding-bottom: 15px; margin-bottom: 30px; }
        h2 { margin: 0; letter-spacing: 2px; color: var(--primary-color); }
        .brand-sub { font-size: 12px; color: var(--accent-color); text-transform: uppercase; margin-top: 5px; }

        /* æœå°‹æ¡† */
        .search-container { position: relative; margin-bottom: 25px; }
        input[type="text"] { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; transition: border 0.3s; }
        input[type="text"]:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 5px rgba(197, 160, 89, 0.2); }

        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; border-collapse: collapse; background: white; }
        th { background-color: var(--primary-color); color: white; padding: 15px 10px; text-align: left; font-weight: 400; font-size: 14px; }
        td { padding: 15px 10px; border-bottom: 1px solid #eee; font-size: 15px; }
        tr:hover { background-color: #fcfaf5; }

        /* ç‹€æ…‹æ¨£å¼ */
        .stock-tag { padding: 4px 8px; border-radius: 4px; font-size: 13px; font-weight: bold; }
        .low-stock { color: #d9534f; background: #fff1f0; border: 1px solid #ffa39e; }
        .in-stock { color: #52c41a; background: #f6ffed; border: 1px solid #b7eb8f; }
        
        .loading { text-align: center; padding: 40px; color: #999; }
        #auth-screen { display: none; text-align: center; padding-top: 100px; }
        #main-content { display: none; }
    </style>
</head>
<body>

<div id="auth-screen">
    <h2>è«‹è¼¸å…¥å­˜å–å¯†ç¢¼</h2>
    <p style="color: #666;">æ­¤é é¢åƒ…ä¾›å…§éƒ¨äººå“¡ä½¿ç”¨</p>
</div>

<div class="container" id="main-content">
    <div class="header">
        <h2>åº«å­˜å³æ™‚æŸ¥è©¢ç³»çµ±</h2>
        <div class="brand-sub">Inventory Management System</div>
    </div>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="æœå°‹ SKUã€ç”¢å“åç¨±...">
    </div>

    <div id="loading" class="loading">æ­£åœ¨é€£ç·šè‡³å¾Œç«¯è³‡æ–™åº«...</div>
    
    <table id="productTable" style="display:none;">
        <thead>
            <tr>
                <th>SKU ç·¨è™Ÿ</th>
                <th>ç”¢å“åç¨±</th>
                <th style="text-align: right;">å”®åƒ¹</th>
                <th style="text-align: center;">åº«å­˜ç‹€æ…‹</th>
            </tr>
        </thead>
        <tbody id="productBody"></tbody>
    </table>
</div>

<script>
    // --- è¨­å®šå€ ---
    const API_BASE = "https://api.murain.tw"; // ğŸ’¡ è«‹æ›æˆæ‚¨çš„ Worker ç¶²å€
    const VIEW_PASSWORD = "88"; // ğŸ’¡ è«‹è¨­å®šæ‚¨çš„å¯†ç¢¼
    // -------------

    let allProducts = [];

    // å•Ÿå‹•å¯†ç¢¼é©—è­‰
    function checkAuth() {
        const pass = prompt("è«‹è¼¸å…¥å…§éƒ¨æŸ¥è©¢å¯†ç¢¼ï¼š");
        if (pass === VIEW_PASSWORD) {
            document.getElementById('main-content').style.display = 'block';
            fetchInventory();
        } else {
            alert("å¯†ç¢¼éŒ¯èª¤ï¼Œæ‹’çµ•å­˜å–ã€‚");
            document.getElementById('auth-screen').style.display = 'block';
        }
    }

    // æŠ“å–å¾Œç«¯è³‡æ–™
    async function fetchInventory() {
        try {
            const response = await fetch(`${API_BASE}/public/products?limit=1000`);
            const data = await response.json();
            
            if (data.ok) {
                allProducts = data.items;
                displayProducts(allProducts);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('productTable').style.display = 'table';
            }
        } catch (error) {
            document.getElementById('loading').innerText = "âŒ ç„¡æ³•è®€å–è³‡æ–™ï¼Œè«‹ç¢ºèªå¾Œç«¯æ˜¯å¦é‹ä½œä¸­ã€‚";
        }
    }

    // å‘ˆç¾è³‡æ–™
    function displayProducts(products) {
        const body = document.getElementById('productBody');
        body.innerHTML = "";

        products.forEach(p => {
            const row = document.createElement('tr');
            const isLow = p.stock <= 3; // è¨­å®šåº«å­˜ä½æ–¼ 3 ä»¶é¡¯ç¤ºè­¦å‘Š
            
            row.innerHTML = `
                <td style="font-family: monospace; color: #666;">${p.sku || '-'}</td>
                <td style="font-weight: 500;">${p.title || p.name || '-'}</td>
                <td style="text-align: right; color: var(--accent-color); font-weight: bold;">
                    $${p.price?.toLocaleString() || 0}
                </td>
                <td style="text-align: center;">
                    <span class="stock-tag ${isLow ? 'low-stock' : 'in-stock'}">
                        ${isLow ? 'âš  ä½åº«å­˜: ' : 'ç¾è²¨: '}${p.stock ?? 0}
                    </span>
                </td>
            `;
            body.appendChild(row);
        });
    }

    // æœå°‹éæ¿¾åŠŸèƒ½
    document.getElementById('searchInput').addEventListener('input', (e) => {
        const keyword = e.target.value.toLowerCase();
        const filtered = allProducts.filter(p => 
            (p.sku && p.sku.toLowerCase().includes(keyword)) || 
            (p.title && p.title.toLowerCase().includes(keyword))
        );
        displayProducts(filtered);
    });

    // é é¢è¼‰å…¥å¾Œç«‹å³è¦æ±‚å¯†ç¢¼
    window.onload = checkAuth;
</script>

</body>
</html>
