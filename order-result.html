<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>訂單結果</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      margin:0;
      padding:0;
      background:#f8f8f8;
    }
    .wrap{
      max-width:480px;
      margin:40px auto;
      padding:24px 20px 32px;
      background:#fff;
      border-radius:16px;
      box-shadow:0 4px 12px rgba(0,0,0,.06);
      text-align:center;
    }
    h1{
      font-size:20px;
      margin:0 0 8px;
    }
    .ok{color:#008a00;}
    .fail{color:#d34040;}
    .order-id{
      font-weight:600;
      margin:8px 0;
      word-break:break-all;
    }
    .amount{
      margin:4px 0 12px;
    }
    .tip{
      font-size:13px;
      color:#777;
      line-height:1.5;
      margin-top:12px;
    }
    .btn{
      margin-top:20px;
      padding:10px 18px;
      border-radius:999px;
      border:none;
      font-size:15px;
      background:#222;
      color:#fff;
    }
  </style>
</head>
<body>
  <div class="wrap" id="box">
    <h1>處理中...</h1>
    <p class="tip">請稍候</p>
  </div>

  <script>
    (function(){
      const params = new URLSearchParams(location.search);

      // 兩種來源：
      // ① 你自己導過來的：?order_id=xxx&total=yyy
      // ② PayUNI 回傳：?Status=SUCCESS&MerTradeNo=xxx&Amount=yyy...
      let orderId = params.get("order_id")
                  || params.get("MerTradeNo")
                  || params.get("merTradeNo")
                  || "";
      let total   = params.get("total")
                  || params.get("Amount")
                  || params.get("amount")
                  || "";
      let status  = (params.get("Status") || params.get("status") || "").toUpperCase();

      const box = document.getElementById("box");

      function fmtAmount(v){
        const n = Number(v || 0);
        if (!n) return "";
        return "NT$ " + n.toLocaleString("zh-TW");
      }

      // 沒拿到任何資訊，就給一個安全的提示，不要空白
      if (!orderId && !status && !total) {
        box.innerHTML = `
          <h1>付款結果回傳中</h1>
          <p class="tip">
            如果畫面長時間停留在此頁，<br>
            請回到 LINE 聊天室重新開啟「訂單查詢」或聯絡小幫手確認。
          </p>
        `;
        return;
      }

      // 判斷成功 / 失敗 / 其他狀態
      let isSuccess = false;
      let title = "訂單已建立";
      let cls = "ok";
      let desc = "";

      if (status) {
        if (status === "SUCCESS") {
          isSuccess = true;
          title = "付款成功，訂單已成立";
          desc  = "我們已收到您的款項，後續會盡快為您安排出貨。";
        } else if (status === "FAIL" || status === "FAILED") {
          title = "付款失敗";
          cls   = "fail";
          desc  = "此筆交易未完成扣款，若有疑問請聯絡客服。";
        } else {
          title = "付款處理中";
          desc  = "交易狀態由金流端處理中，請稍後再查詢訂單狀態。";
        }
      } else {
        // 沒有 Status（例如你自己帶 order_id 過來），當作訂單已建立
        isSuccess = true;
        title = "訂單建立完成";
        desc  = "後續付款狀態請以通知訊息為準。";
      }

      box.innerHTML = `
        <h1 class="${cls}">${title}</h1>
        ${orderId ? `<div class="order-id">訂單編號：${orderId}</div>` : ""}
        ${total   ? `<div class="amount">訂單金額：${fmtAmount(total)}</div>` : ""}
        <p class="tip">${desc || ""}</p>
        <p class="tip">
          您可以關閉此頁面，回到 LINE 聊天室查看訂單明細或聯絡小幫手。
        </p>
        <button class="btn" onclick="window.location.href='https://line.me/R/msg/text/?我已完成付款，請協助確認訂單狀態，訂單編號：${encodeURIComponent(orderId || '')}'">
          回到 LINE 通知小幫手
        </button>
      `;
    })();
  </script>
</body>
</html>
