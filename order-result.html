<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>付款結果｜MURAIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #f5f5f5;
      color: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .wrap {
      width: 100%;
      max-width: 480px;
      padding: 20px 16px;
    }
    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 22px 20px 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      text-align: center;
    }
    .badge {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      margin: 0 auto 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }
    .badge.success {
      background: #e6f8f0;
    }
    .badge.fail {
      background: #ffecec;
    }
    .badge span {
      line-height: 1;
    }
    h1 {
      font-size: 20px;
      margin: 4px 0 6px;
      letter-spacing: 0.05em;
    }
    p {
      margin: 4px 0;
      font-size: 14px;
      line-height: 1.6;
      color: #555;
    }
    .hint {
      margin-top: 10px;
      font-size: 12px;
      color: #888;
    }
    .btn-row {
      margin-top: 16px;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    button {
      border: none;
      outline: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 9px 18px;
      font-size: 14px;
      line-height: 1.2;
    }
    .btn-main {
      background: #111;
      color: #fff;
      min-width: 120px;
    }
    .btn-ghost {
      background: #f2f2f2;
      color: #333;
    }
    .brand {
      margin-top: 14px;
      text-align: center;
      font-size: 11px;
      color: #aaa;
      letter-spacing: .12em;
      text-transform: uppercase;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div id="badge" class="badge success">
        <span id="badgeIcon">✓</span>
      </div>
      <h1 id="title">付款已送出</h1>
      <p id="message">
        系統已收到金流的回傳。實際訂單狀態與明細，請以
        <br>LINE 通知與 MURAIN 後台訂單為準。
      </p>
      <p id="subMessage"></p>
      <p class="hint">
        若您沒有在幾分鐘內收到任何訊息，或付款狀態有疑問，
        請截圖此畫面並聯繫沐雨客服協助確認。
      </p>
      <div class="btn-row">
        <button class="btn-main" onclick="closeWindowOrBack()">關閉此頁面</button>
        <button class="btn-ghost" onclick="refreshPage()">重新整理</button>
      </div>
    </div>
    <div class="brand">MURAIN</div>
  </div>

  <script>
    (function init() {
      const params = new URLSearchParams(window.location.search);
      const status = (params.get("status") || "").toLowerCase();
      const msg = params.get("msg") || params.get("message") || "";

      const badge = document.getElementById("badge");
      const badgeIcon = document.getElementById("badgeIcon");
      const title = document.getElementById("title");
      const message = document.getElementById("message");
      const subMessage = document.getElementById("subMessage");

      if (status === "success") {
        badge.classList.remove("fail");
        badge.classList.add("success");
        badgeIcon.textContent = "✓";
        title.textContent = "付款成功";
        message.textContent = "感謝您的購買，我們已收到本次付款。訂單細節與出貨進度將透過 LINE 通知。";
      } else if (status === "fail" || status === "error") {
        badge.classList.remove("success");
        badge.classList.add("fail");
        badgeIcon.textContent = "!";
        title.textContent = "付款未完成";
        message.textContent = "剛剛的付款尚未成功，或金流回報有誤。建議請勿重複刷卡，先聯繫沐雨客服協助確認。";
      } else {
        // 沒帶 status → 使用預設文案（目前 AFTEE / 信用卡情況）
        badge.classList.add("success");
        badgeIcon.textContent = "✓";
        title.textContent = "付款已送出";
        message.innerHTML = "金流端已回傳結果。實際訂單狀態請以 LINE 通知與訂單明細為準。";
      }

      if (msg) {
        subMessage.textContent = msg;
      }
    })();

    function closeWindowOrBack() {
      // 盡量關掉頁面：先試 window.close，再退回上一頁
      try { window.close(); } catch (e) {}
      setTimeout(function () {
        if (window.history.length > 1) {
          window.history.back();
        }
      }, 150);
    }

    function refreshPage() {
      window.location.reload();
    }
  </script>
</body>
</html>
