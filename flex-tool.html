<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>MURAIN LINE Flex Message 設計師</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind CSS（只給這個工具用，不影響其他頁面） -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body {
        background: radial-gradient(circle at 0 0, #22c55e22, transparent 55%),
          radial-gradient(circle at 100% 100%, #4b556322, transparent 55%),
          #020617;
        min-height: 100vh;
      }
      textarea {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
      }
    </style>
  </head>

  <body class="text-slate-100">
    <div class="max-w-5xl mx-auto px-4 py-6">
      <header class="flex items-center justify-between mb-4">
        <div>
          <h1 class="text-xl font-semibold tracking-wide">
            MURAIN LINE Flex Message 設計工具
          </h1>
          <p class="text-xs text-slate-400 mt-1">
            左邊編輯 JSON，按「更新預覽連結」後，點右下按鈕可在 LINE 官方
            Flex 模擬器中預覽。
          </p>
        </div>
      </header>

      <div
        class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-900/60 border border-slate-800 rounded-xl p-4"
      >
        <!-- 左側：JSON 編輯區 -->
        <div class="flex flex-col">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-slate-200"
              >Flex JSON（可自行修改）</span
            >
            <button
              id="btnUpdate"
              class="px-3 py-1.5 text-xs rounded-lg border border-emerald-500/70 text-emerald-300 hover:bg-emerald-500/10 transition"
            >
              更新預覽連結
            </button>
          </div>

          <textarea
            id="flexJson"
            class="w-full min-h-[360px] text-xs md:text-sm p-3 rounded-lg bg-slate-950/80 border border-slate-800 focus:outline-none focus:ring-1 focus:ring-emerald-500/70"
          >{
  "type": "bubble",
  "body": {
    "type": "box",
    "layout": "vertical",
    "paddingAll": "16px",
    "backgroundColor": "#18181B",
    "contents": [
      {
        "type": "text",
        "text": "訂金確認",
        "size": "lg",
        "weight": "bold",
        "align": "center",
        "color": "#D4AF37"
      },
      {
        "type": "box",
        "layout": "vertical",
        "margin": "md",
        "spacing": "sm",
        "contents": [
          {
            "type": "text",
            "text": "Lumi 您好",
            "size": "sm",
            "color": "#F9FAFB",
            "align": "left"
          },
          {
            "type": "box",
            "layout": "horizontal",
            "margin": "md",
            "contents": [
              {
                "type": "box",
                "layout": "vertical",
                "flex": 1,
                "spacing": "xs",
                "contents": [
                  {
                    "type": "text",
                    "text": "收到金額",
                    "size": "xs",
                    "color": "#9CA3AF"
                  },
                  {
                    "type": "text",
                    "text": "NT$ 1,000",
                    "size": "lg",
                    "weight": "bold",
                    "color": "#D4AF37"
                  }
                ]
              },
              {
                "type": "box",
                "layout": "vertical",
                "flex": 1,
                "spacing": "xs",
                "contents": [
                  {
                    "type": "text",
                    "text": "保留期限",
                    "size": "xs",
                    "color": "#9CA3AF",
                    "align": "right"
                  },
                  {
                    "type": "text",
                    "text": "2025.12.06",
                    "size": "sm",
                    "weight": "bold",
                    "color": "#E5E7EB",
                    "align": "right"
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "type": "button",
        "style": "primary",
        "height": "sm",
        "margin": "lg",
        "color": "#C6A66D",
        "action": {
          "type": "uri",
          "label": "查看訂單詳情",
          "uri": "https://example.com/order/OD1765006315304"
        }
      },
      {
        "type": "box",
        "layout": "baseline",
        "margin": "md",
        "spacing": "sm",
        "contents": [
          {
            "type": "text",
            "text": "訂單編號",
            "size": "xs",
            "color": "#9CA3AF",
            "flex": 3
          },
          {
            "type": "text",
            "text": "OD1765006315304",
            "size": "xs",
            "color": "#E5E7EB",
            "flex": 5,
            "wrap": true
          }
        ]
      }
    ]
  },
  "styles": {
    "body": {
      "backgroundColor": "#18181B"
    }
  }
}</textarea>

          <p
            id="errorMsg"
            class="mt-2 text-xs text-rose-300 hidden whitespace-pre-line"
          ></p>
        </div>

        <!-- 右側：說明 & 連結區 -->
        <div class="flex flex-col justify-between">
          <div class="mb-4">
            <h2 class="text-sm font-medium text-slate-200 mb-2">
              使用說明
            </h2>
            <ol class="list-decimal list-inside text-xs text-slate-300 space-y-1">
              <li>左側是目前的「訂金確認」Flex 卡片 JSON。</li>
              <li>如需改顏色、文字、金額、日期，直接改 JSON 內容即可。</li>
              <li>修改完成後，點上方的「更新預覽連結」。</li>
              <li>再點下方按鈕，在 LINE 官方 Flex 模擬器中預覽。</li>
            </ol>
          </div>

          <div class="mt-6 border-t border-slate-800 pt-4">
            <a
              id="openSimulator"
              href="javascript:void(0)"
              target="_blank"
              class="inline-flex items-center justify-center px-4 py-2 text-sm rounded-lg bg-emerald-500/90 hover:bg-emerald-400 text-slate-950 font-medium transition disabled:opacity-40 disabled:pointer-events-none"
            >
              在 LINE Flex 模擬器中開啟
            </a>
            <p class="mt-2 text-[11px] text-slate-400">
              若按鈕是灰色，代表 JSON 有錯或尚未產生預覽連結。
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const textarea = document.getElementById("flexJson");
      const btnUpdate = document.getElementById("btnUpdate");
      const link = document.getElementById("openSimulator");
      const errorMsg = document.getElementById("errorMsg");

      function updateLink() {
        const raw = textarea.value.trim();
        errorMsg.classList.add("hidden");
        errorMsg.textContent = "";

        if (!raw) {
          link.href = "javascript:void(0)";
          link.classList.add("pointer-events-none", "opacity-40");
          return;
        }

        try {
          JSON.parse(raw); // 確認格式正確
          const encoded = encodeURIComponent(raw);
          const url =
            "https://developers.line.biz/flex-simulator/?data=" + encoded;
          link.href = url;
          link.classList.remove("pointer-events-none", "opacity-40");
        } catch (e) {
          link.href = "javascript:void(0)";
          link.classList.add("pointer-events-none", "opacity-40");
          errorMsg.textContent =
            "JSON 格式有誤，請檢查括號、逗號與引號。\n錯誤訊息：" +
            (e.message || e.toString());
          errorMsg.classList.remove("hidden");
        }
      }

      btnUpdate.addEventListener("click", updateLink);
      window.addEventListener("load", updateLink);
    </script>
  </body>
</html>
